@using Minem.Sgpam.InfraEstructura;
@model Minem.Sgpam.TransporteDatos.DtoEntidades.ListarExpedienteDTO

@{
    ViewData["Title"] = "Expedientes de LNR";
}

<form id="MyForm" asp-controller="Expediente" asp-action="Index" autocomplete="off" data-ajax="true" data-ajax-method="POST">

    <div class="row">

        <div class="col-md-3 col-sm-12 col-xs-12 form-group">
            <div class="form-group">
                <label class="control-label col-md-3 col-sm-3 col-xs-12">Expediente</label>
                <div class="col-md-9 col-sm-9 col-xs-12">
                    <input type="text" class="form-control text-uppercase" name=vNroExp maxlength="20">
                </div>
            </div>
        </div>

        <div class="col-md-6 col-sm-12 col-xs-12 form-group">
            <div class="form-group">
                <label class="control-label col-md-4 col-sm-4 col-xs-12">Zona-Concesion-Proyecto</label>
                <div class="col-md-8 col-sm-8 col-xs-12">
                    <input type="text" class="form-control text-uppercase" name=vZona maxlength="50">
                </div>
            </div>
        </div>

        <div class="col-md-2 col-sm-12 col-xs-12 form-group">
            <div class="boton">
                <button type="submit">Buscar  <i class="fa fa-search"></i></button>
                @*<button type="submit" class="btn btn-agrosecondary mr-sm-1">Buscar <i class="fa fa-search"></i></button>*@
                @*<a asp-action="Index">Buscar <i class="fa fa-search"></i></a>*@
            </div>
        </div>

        <div class="col-md-3 col-sm-12 col-xs-12 form-group">
            <div class="form-group">
                <label class="control-label col-md-3 col-sm-3 col-xs-12" for="cboDepartamento">Región:</label>
                <div class="col-md-9 col-sm-9 col-xs-12">
                    <select class="select2_single form-control" id="cboDepartamento" tabindex="-1">
                        <option value="0" selected="selected">Seleccione</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="col-md-3 col-sm-12 col-xs-12 form-group">
            <div class="form-group">
                <label class="control-label col-md-3 col-sm-3 col-xs-12" for="cboProvincia">Provincia:</label>
                <div class="col-md-9 col-sm-9 col-xs-12">
                    <select class="select2_single form-control" id="cboProvincia" tabindex="-1">
                        <option value="0" selected="selected">Seleccione</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="col-md-4 col-sm-12 col-xs-12 form-group">
            <div class="form-group">
                <label class="control-label col-md-3 col-sm-3 col-xs-12" for="cboDistrito">Distrito:</label>
                <div class="col-md-9 col-sm-9 col-xs-12">
                    <select class="select2_single form-control" id="cboDistrito" tabindex="-1">
                        <option value="0" selected="selected">Seleccione</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <div class="x_title2">
        <div align="center" class="titulo-m">
            <h3>Lista de Expedientes de LNR</h3>
        </div>

        <ul class="nav navbar-right panel_toolbox">
            <li>
                <div class="boton">
                    <a asp-action="AgregarEditar"> Agregar <i class="fa fa-plus"></i></a>
                </div>
            </li>
            @*<li>
                    <div class="boton">
                        <a href="#">Exportar  <i class="fa fa-sign-out"></i></a> </div>
                </li>*@
        </ul>

        <div class="clearfix"></div>
    </div>

    @*<table id="datatable" class="table table-striped table-bordered pam">
            <thead>
                <tr>
                    <th>Nro Exopediente</th>
                    <th>Zona-Concesion-Proyecto</th>
                    <th>Año</th>
                    <th>Declarante</th>
                    <th>Total LNR</th>
                    <th>Informe</th>
                    <th>Opciones</th>
                </tr>
            </thead>
            <tbody>
                @if (!Model.ListaExpediente.Any())
                {
                    <tr class="even pointer">
                        <td class=" " colspan="7">No existen registros</td>
                    </tr>
                }
                else
                {
                    foreach (var item in Model.ListaExpediente)
                    {
                        <tr class="even pointer">
                            <td class=" ">@item.Nro_Expediente</td>
                            <td class=" ">@item.Zona</td>
                            <td class=" ">@item.Fec_Ingreso</td>
                            <td class=" ">@item.Declarante</td>
                            <td class=" "></td>
                            <td class=" "></td>
                            <td class=" ">
                                <ul class="nav navbar-left panel_toolbox">
                                    <li>
                                        <div class="boton2">
                                            <a asp-action="AgregarEditar" asp-route-vId="@item.Id_Expediente" title="Editar Registro"><i class="fas fa-edit"></i></a>
                                        </div>
                                    </li>
                                </ul>
                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>*@

    <div id="DivInformacionGrafica">
        @Html.Partial("_PartialExpediente", Model.ListaExpediente)
    </div>



    @*<input type="hidden" asp-for="Ubigeo" />*@
    <input type="hidden" name="vZona" id="vZona" />
    <input type="hidden" name="vUbigeo" id="vUbigeo" />

</form>

@section Scripts {
    <script>
        $(document).ready(function () {
            var IdUbigeo = @Html.Raw(Json.Serialize(ViewBag.Ubigeo));
            const dpto = [...new Map(IdUbigeo.map(function (a) { return { id_Departamento: a.id_Departamento, departamento: a.departamento } }).map(a => [a.id_Departamento, a])).values()];
            dpto.forEach(function (o, t) { $("#cboDepartamento").append('<option value="' + o.id_Departamento + '">' + o.departamento + "</option>") });
            $("#cboDepartamento").on("change", function () {
                var data = IdUbigeo.filter(o => o.id_Departamento == $("#cboDepartamento").val());
                const prov = [...new Map(data.map(function (o) { return { id_Provincia: o.id_Provincia, provincia: o.provincia } }).map(o => [o.id_Provincia, o])).values()];
                $("#cboProvincia").empty();
                $("#cboProvincia").append('<option value="0">Seleccione</option>');
                prov.forEach(function (o, i) { $("#cboProvincia").append('<option value="' + o.id_Provincia + '">' + o.provincia + "</option>") })
                //console.log($("#cboDepartamento").val());
                $("#vUbigeo").val($("#cboDepartamento").val());
            });

            $('#cboProvincia').on('change', function () {
                var data = IdUbigeo.filter(x => x.id_Provincia == $('#cboProvincia').val());
                const dist = [...new Map(data.map(function (o) { return { id_Distrito: o.id_Distrito, distrito: o.distrito } }).map(o => [o.id_Distrito, o])).values()];
                $('#cboDistrito').empty();
                $('#cboDistrito').append('<option value="0">Seleccione</option>');
                dist.forEach(function (o, i) { $('#cboDistrito').append('<option value="' + o.id_Distrito + '">' + o.distrito + '</option>') })
                //console.log($("#cboProvincia").val());
                if ($("#cboProvincia").val() === '0')
                    $("#vUbigeo").val($("#cboDepartamento").val());
                else
                    $("#vUbigeo").val($("#cboProvincia").val());
            });

            $('#cboDistrito').on('change', function () {
                var data = IdUbigeo.filter(x => x.id_Distrito == $('#cboDistrito').val());
                //console.log($("#cboDistrito").val());
                if ($("#cboDistrito").val() === '0')
                    $("#vUbigeo").val($("#cboProvincia").val());
                else
                    $("#vUbigeo").val($("#cboDistrito").val());
            });

            //if ($("#IdAlmacen").val() > 0) {
            //    var Registro = vUbigeo.filter(i => i.codigoUbigeo == $("#Ubigeo").val())[0];
            //    $("#cboDepartamento").val(Registro.idDepartamento).change(), $("#cboProvincia").val(Registro.idProvincia).change(), $("#cboDistrito").val(Registro.idDistrito)
            //}
        });




    </script>
}
